# Dockerfile.ui
FROM node:20.13.1-alpine AS runner
WORKDIR /app

# 1) pnpm をグローバルインストール
RUN npm install -g pnpm@9.12.3

# 2) ワークスペース設定・ルートの package.json・lockfile をコピー
COPY pnpm-workspace.yaml package.json pnpm-lock.yaml ./

# 3) workspace:* のパッケージ群が見つかるようにモノレポの packages 全体をコピー
COPY packages ./packages

# 4) UI アプリの package.json とビルド済み成果物 dist をコピー
COPY apps/agent-tars/package.json ./apps/agent-tars/
COPY apps/agent-tars/dist           ./apps/agent-tars/dist

# 5) 本番依存だけインストール（workspace:* も解決される）
WORKDIR /app/apps/agent-tars
RUN pnpm install --prod --no-frozen-lockfile

# 6) 起動コマンド
CMD ["pnpm", "run", "start:web"]
